#+title: dotfile
我的 (Literate) Dotfiles

* README
生成 README.md

#+begin_src markdown :tangle ~/.emacs.d/README.md :mkdirp "yes"
  # Dotfiles
  [![Build Status](https://www.travis-ci.com/teddy-ma/dotfiles.svg?branch=master)](https://www.travis-ci.com/teddy-ma/dotfiles)


  这是我的 `dotfiles`,  使用 Emacs 进行管理, 支持 macOS 与 Linux

  # Install

  完成下面所写的准备工作后，只要打开 Emacs, 等待配置完成，输入 `C-i` 打开配置 `dotfiles.org` 文件，
  使用 `C-c C-v t=` 就能生成各种 dotfiles 了。

  ## macOS prepare

  macOS 主要依赖 [thoughtbot 的 laptop](https://github.com/thoughtbot/laptop) 脚本进行初始化，然后配合 ownCloud 上储存的私有配置文件完成配置。

    ```shell
    curl --remote-name https://raw.githubusercontent.com/thoughtbot/laptop/master/mac
    sh mac 2>&1 | tee ~/laptop.log

    brew install fish owncloud

    chsh -s /usr/local/bin/fish

    git clone git@github.com:teddy-ma/dotfiles.git ~/.emacs.d
    ```

  ## Linux prepare

  Linux 下只需要安装几个最基础的包

    ```shell
    sudo pacman -Syu git fish ttf-inconsolata ttf-arphic-uming fzf owncloud-client

    git clone git@github.com:teddy-ma/dotfiles.git ~/.emacs.d/
    ```

#+end_src

* Git
** basic
基础配置

#+begin_src shell
  ln -s ~/ownCloud/Config/id_rsa ~/.ssh/id_rsa
  ln -s ~/ownCloud/Config/id_rsa.pub ~/.ssh/id_rsa.pub
#+end_src

#+begin_src conf :tangle ~/.gitconfig
  [include]
          path = ~/.config/git/gitconfig
  [push]
          default = simple
  [pull]
          rebase = false
  [core]
          excludesfile = ~/.gitignore_global
  [commit]
          template = ~/.gitmessage
  [protocol]
          version = 2
  [pager]
          branch = false
  [user]
          name = teddy
          email = mlc880926@gmail.com
#+end_src

** global ignore
全局的 ignore 配置

#+begin_src conf :tangle ~/.gitignore_global
#############################################################################
# https://github.com/github/gitignore/blob/master/Global/Archives.gitignore #
#############################################################################
# It's better to unpack these files and commit the raw source because
# git has its own built in compression methods.
*.7z
*.jar
*.rar
*.zip
*.gz
*.bzip
*.bz2
*.xz
*.lzma
*.cab

#packing-only formats
*.iso
*.tar

#package management formats
*.dmg
*.xpi
*.gem
*.egg
*.deb
*.rpm
*.msi
*.msm
*.msp
###########################################################################
# https://github.com/github/gitignore/blob/master/Global/Cloud9.gitignore #
###########################################################################
# Cloud9 IDE - http://c9.io
.c9revisions
.c9
############################################################################
# https://github.com/github/gitignore/blob/master/Global/CodeKit.gitignore #
############################################################################
# General CodeKit files to ignore
config.codekit
/min
##########################################################################
# https://github.com/github/gitignore/blob/master/Global/Emacs.gitignore #
##########################################################################
# -*- mode: gitignore; -*-
*~
\#*\#
/.emacs.desktop
/.emacs.desktop.lock
*.elc
auto-save-list
tramp
.\#*

# Org-mode
.org-id-locations
*_archive

# flymake-mode
*_flymake.*

# eshell files
/eshell/history
/eshell/lastdir

# elpa packages
/elpa/

# reftex files
*.rel

# AUCTeX auto folder
/auto/

# cask packages
.cask/
####################################################################################
# https://github.com/github/gitignore/blob/master/Global/IPythonNotebook.gitignore #
####################################################################################
# Temporary data
.ipynb_checkpoints/
##############################################################################
# https://github.com/github/gitignore/blob/master/Global/JetBrains.gitignore #
##############################################################################
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm

*.iml

## Directory-based project format:
.idea/
# if you remove the above rule, at least ignore the following:

# User-specific stuff:
# .idea/workspace.xml
# .idea/tasks.xml
# .idea/dictionaries

# Sensitive or high-churn files:
# .idea/dataSources.ids
# .idea/dataSources.xml
# .idea/sqlDataSources.xml
# .idea/dynamic.xml
# .idea/uiDesigner.xml

# Gradle:
# .idea/gradle.xml
# .idea/libraries

# Mongo Explorer plugin:
# .idea/mongoSettings.xml

## File-based project format:
*.ipr
*.iws

## Plugin-specific files:

# IntelliJ
out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
################################################################################
# https://github.com/github/gitignore/blob/master/Global/LibreOffice.gitignore #
################################################################################
# LibreOffice locks
.~lock.*#
##########################################################################
# https://github.com/github/gitignore/blob/master/Global/Linux.gitignore #
##########################################################################
*~

# KDE directory preferences
.directory

# Linux trash folder which might appear on any partition or disk
.Trash-*
####################################################################################
# https://github.com/github/gitignore/blob/master/Global/MicrosoftOffice.gitignore #
####################################################################################
*.tmp

# Word temporary
~$*.doc*

# Excel temporary
~$*.xls*

# Excel Backup File
*.xlk
##############################################################################
# https://github.com/github/gitignore/blob/master/Global/NotepadPP.gitignore #
##############################################################################
# Notepad++ backups #
*.bak
########################################################################
# https://github.com/github/gitignore/blob/master/Global/OSX.gitignore #
########################################################################
.DS_Store
.AppleDouble
.LSOverride

# Icon must end with two \r
Icon


# Thumbnails
._*

# Files that might appear on external disk
.Spotlight-V100
.Trashes

# Directories potentially created on remote AFP share
.AppleDB
.AppleDesktop
Network Trash Folder
Temporary Items
.apdisk
##########################################################################
# https://github.com/github/gitignore/blob/master/Global/Redis.gitignore #
##########################################################################
# Ignore redis binary dump (dump.rdb) files

*.rdb
################################################################################
# https://github.com/github/gitignore/blob/master/Global/SublimeText.gitignore #
################################################################################
# cache files for sublime text
*.tmlanguage.cache
*.tmPreferences.cache
*.stTheme.cache

# workspace files are user-specific
*.sublime-workspace

# project files should be checked into the repository, unless a significant
# proportion of contributors will probably not be using SublimeText
# *.sublime-project

# sftp configuration file
sftp-config.json
#############################################################################
# https://github.com/github/gitignore/blob/master/Global/TextMate.gitignore #
#############################################################################
*.tmproj
*.tmproject
tmtags
########################################################################
# https://github.com/github/gitignore/blob/master/Global/Vim.gitignore #
########################################################################
[._]*.s[a-w][a-z]
[._]s[a-w][a-z]
*.un~
Session.vim
.netrwhist
*~
############################################################################
# https://github.com/github/gitignore/blob/master/Global/Windows.gitignore #
############################################################################
# Windows image file caches
Thumbs.db
ehthumbs.db

# Folder config file
Desktop.ini

# Recycle Bin used on file shares
$RECYCLE.BIN/

# Windows Installer files
*.cab
*.msi
*.msm
*.msp

# Windows shortcuts
*.lnk
##########################################################################
# https://github.com/github/gitignore/blob/master/Global/Xcode.gitignore #
##########################################################################
build/
*.pbxuser
!default.pbxuser
*.mode1v3
!default.mode1v3
*.mode2v3
!default.mode2v3
*.perspectivev3
!default.perspectivev3
xcuserdata
*.xccheckout
*.moved-aside
DerivedData
*.xcuserstate
###################################################
# EXCERPT https://gist.github.com/octocat/9257657 #
###################################################

# Compiled source #
###################
*.com
*.class
*.dll
*.exe
*.o
*.so

# Logs and databases #
######################
*.sql
*.sqlite
*.log
############
# PERSONAL #
############
tmp/
temp/

# Floobits
.floo
.flooignore

#+end_src
** git message
git 提交信息的格式模板

#+begin_src conf :tangle ~/.gitmessage
Why:

*

This change addresses the need by:

*

# 50-character subject line
#
# 72-character wrapped longer description.
#+end_src
** git diff
https://github.com/dandavison/delta

#+begin_src conf :tangle ~/.gitconfig
[core]
    pager = delta

[interactive]
    diffFilter = delta --color-only

[delta]
    features = line-numbers decorations
    whitespace-error-style = 22 reverse

[delta "decorations"]
    commit-decoration-style = bold yellow box ul
    file-style = bold yellow ul
    file-decoration-style = none
#+end_src

* homebrew
常用的软件都列在这里了

#+begin_src conf :tangle /tmp/Brewfile
tap "d12frosted/emacs-plus"
tap "homebrew/bundle"
tap "homebrew/cask"
tap "homebrew/cask-drivers"
tap "homebrew/cask-fonts"
tap "homebrew/core"
tap "homebrew/services"
tap "thoughtbot/formulae"
tap "universal-ctags/universal-ctags"
brew "openssl@1.1"
brew "asciinema"
brew "autojump"
brew "bat"
brew "clisp"
brew "cloc"
brew "cmake"
brew "coreutils"
brew "ctags", link: false
brew "erlang"
brew "exa"
brew "ffmpeg"
brew "fish"
brew "fswatch"
brew "fx"
brew "fzy"
brew "fzf"
brew "geckodriver"
brew "gh"
brew "git"
brew "git-delta"
brew "git-quick-stats"
brew "openjdk"
brew "gradle"
brew "graphviz"
brew "gsl"
brew "htop"
brew "httpie"
brew "hub"
brew "iftop"
brew "imagemagick"
brew "jq"
brew "memcached"
brew "mysql", restart_service: true
brew "ncdu"
brew "neofetch"
brew "neovim"
brew "onefetch"
brew "pandoc"
brew "percol"
brew "poppler"
brew "postgresql", restart_service: true
brew "prettyping"
brew "pstree"
brew "reattach-to-user-namespace"
brew "redis", restart_service: true
brew "ripgrep"
brew "rustup-init"
brew "sbcl"
brew "speedtest-cli"
brew "splint"
brew "stow"
brew "terminal-notifier"
brew "the_silver_searcher"
brew "tig"
brew "tldr"
brew "tmux"
brew "tree"
brew "typespeed"
brew "vim"
brew "w3m"
brew "watchman"
brew "wget"
brew "wtfutil"
brew "yarn"
brew "you-get"
brew "youtube-dl"
brew "zsh"
cask "balenaetcher"
cask "chromium"
cask "clashx"
cask "emacs"
cask "firefox"
cask "font-cascadia-code"
cask "font-hack-nerd-font"
cask "font-noto-sans-mono"
cask "font-source-code-pro"
cask "font-source-code-pro-for-powerline"
cask "gitup"
cask "google-chrome"
cask "gpg-suite"
cask "hammerspoon"
cask "iina"
cask "intellij-idea-ce"
cask "owncloud"
cask "slack"
cask "tableplus"
cask "telegram"
cask "visual-studio-code"
#+end_src
* Neovim
不太用 vim, 只有最基本的配置

#+begin_src conf :tangle ~/.config/nvim/init.vim :mkdirp "yes"
" Douglas Black
" Colors {{{
syntax enable           " enable syntax processing
" }}}
" Misc {{{
set ttyfast                     " faster redraw
set backspace=indent,eol,start
" }}}
" Spaces & Tabs {{{
set tabstop=4           " 4 space tab
set expandtab           " use spaces for tabs
set softtabstop=4       " 4 space tab
set shiftwidth=4
set modelines=1
filetype indent on
filetype plugin on
set autoindent
" }}}
" UI Layout {{{
set number              " show line numbers
set showcmd             " show command in bottom bar
set nocursorline          " highlight current line
set wildmenu
"set lazyredraw
set showmatch           " higlight matching parenthesis
" }}}
" Searching {{{
set ignorecase          " ignore case when searching
set incsearch           " search as characters are entered
set hlsearch            " highlight all matches
" }}}
" Folding {{{
"=== folding ===
set foldmethod=indent   " fold based on indent level
set foldnestmax=10      " max 10 depth
set foldenable          " don't fold files by default on open
nnoremap <space> za
set foldlevelstart=10    " start with fold level of 1
" }}}
" Line Shortcuts {{{
nnoremap j gj
nnoremap k gk
nnoremap B ^
nnoremap E $
nnoremap $ <nop>
nnoremap ^ <nop>
nnoremap gV `[v`]
onoremap an :<c-u>call <SID>NextTextObject('a', 'f')<cr>
xnoremap an :<c-u>call <SID>NextTextObject('a', 'f')<cr>
onoremap in :<c-u>call <SID>NextTextObject('i', 'f')<cr>
xnoremap in :<c-u>call <SID>NextTextObject('i', 'f')<cr>

onoremap al :<c-u>call <SID>NextTextObject('a', 'F')<cr>
xnoremap al :<c-u>call <SID>NextTextObject('a', 'F')<cr>
onoremap il :<c-u>call <SID>NextTextObject('i', 'F')<cr>
xnoremap il :<c-u>call <SID>NextTextObject('i', 'F')<cr>
" }}}
" Leader Shortcuts {{{
let mapleader=","
nnoremap <leader>m :silent make\|redraw!\|cw<CR>
nnoremap <leader>w :NERDTree<CR>
nnoremap <leader>u :GundoToggle<CR>
nnoremap <leader>h :A<CR>
nnoremap <leader>ev :vsp $MYVIMRC<CR>
nnoremap <leader>ez :vsp ~/.zshrc<CR>
nnoremap <leader>sv :source $MYVIMRC<CR>
nnoremap <leader>l :call ToggleNumber()<CR>
nnoremap <leader><space> :noh<CR>
nnoremap <leader>s :mksession<CR>
nnoremap <leader>a :Ag
nnoremap <leader>c :SyntasticCheck<CR>:Errors<CR>
nnoremap <leader>1 :set number!<CR>
nnoremap <leader>d :Make!
nnoremap <leader>r :call RunTestFile()<CR>
nnoremap <leader>g :call RunGoFile()<CR>
vnoremap <leader>y "+y
vmap v <Plug>(expand_region_expand)
vmap <C-v> <Plug>(expand_region_shrink)
inoremap jk <esc>
" }}}
" Powerline {{{
"set encoding=utf-8
"python from powerline.vim import setup as powerline_setup
"python powerline_setup()
"python del powerline_setup
let g:airline#extensions#tabline#left_sep = ' '
let g:airline#extensions#tabline#left_alt_sep = '|'
let g:airline_left_sep = ''
let g:airline_left_alt_sep = ''
let g:airline_right_sep = ''
let g:airline_right_alt_sep = ''
set laststatus=2
" }}}
" CtrlP {{{
let g:ctrlp_match_window = 'bottom,order:ttb'
let g:ctrlp_switch_buffer = 0
let g:ctrlp_working_path_mode = 0
let g:ctrlp_custom_ignore = '\vbuild/|dist/|venv/|target/|\.(o|swp|pyc|egg)$'
" }}}
" NERDTree {{{
let NERDTreeIgnore = ['\.pyc$', 'build', 'venv', 'egg', 'egg-info/', 'dist', 'docs']
" }}}
" Syntastic {{{
let g:syntastic_python_flake8_args='--ignore=E501'
let g:syntastic_ignore_files = ['.java$']
" }}}
" Launch Config {{{
runtime! debian.vim
set nocompatible
" }}}
"" Tmux {{{
"if exists('$TMUX') " allows cursor change in tmux mode
"    let &t_SI = "\<Esc>Ptmux;\<Esc>\<Esc>]50;CursorShape=1\x7\<Esc>\\"
"    let &t_EI = "\<Esc>Ptmux;\<Esc>\<Esc>]50;CursorShape=0\x7\<Esc>\\"
"else
"    let &t_SI = "\<Esc>]50;CursorShape=1\x7"
"    let &t_EI = "\<Esc>]50;CursorShape=0\x7"
"endif
"" }}}
" MacVim {{{
set guioptions-=r
set guioptions-=L
" }}}
" AutoGroups {{{
augroup configgroup
    autocmd!
    autocmd VimEnter * highlight clear SignColumn
    autocmd BufWritePre *.php,*.py,*.js,*.txt,*.hs,*.java,*.md,*.rb :call <SID>StripTrailingWhitespaces()
    autocmd BufEnter *.cls setlocal filetype=java
    autocmd BufEnter *.zsh-theme setlocal filetype=zsh
    autocmd BufEnter Makefile setlocal noexpandtab
    autocmd BufEnter *.sh setlocal tabstop=2
    autocmd BufEnter *.sh setlocal shiftwidth=2
    autocmd BufEnter *.sh setlocal softtabstop=2
augroup END
" }}}
" Backups {{{
set backup
set backupdir=~/.vim-tmp,~/.tmp,~/tmp,/var/tmp,/tmp
set backupskip=/tmp/*,/private/tmp/*
set directory=~/.vim-tmp,~/.tmp,~/tmp,/var/tmp,/tmp
set writebackup
" }}}
" Custom Functions {{{
function! ToggleNumber()
    if(&relativenumber == 1)
        set norelativenumber
        set number
    else
        set relativenumber
    endif
endfunc

function! RunTestFile()
    if(&ft=='python')
        exec ":!" . ". venv/bin/activate; nosetests " .bufname('%') . " --stop"
    endif
endfunction

function! RunGoFile()
    if(&ft=='go')
        exec ":new|0read ! go run " . bufname('%')
    endif
endfunction

function! RunTestsInFile()
    if(&ft=='php')
        :execute "!" . "/Users/dblack/pear/bin/phpunit -d memory_limit=512M -c /usr/local/twilio/src/php/tests/config.xml --bootstrap /usr/local/twilio/src/php/tests/bootstrap.php " . bufname('%') . ' \| grep -v Configuration \| egrep -v "^$" '
    elseif(&ft=='go')
        exec ":!gp test"
    elseif(&ft=='python')
        exec ":read !" . ". venv/bin/activate; nosetests " . bufname('%') . " --nocapture"
    endif
endfunction

" strips trailing whitespace at the end of files. this
" is called on buffer write in the autogroup above.
function! <SID>StripTrailingWhitespaces()
    " save last search & cursor position
    let _s=@/
    let l = line(".")
    let c = col(".")
    %s/\s\+$//e
    let @/=_s
    call cursor(l, c)
endfunction

function! <SID>CleanFile()
    " Preparation: save last search, and cursor position.
    let _s=@/
    let l = line(".")
    let c = col(".")
    " Do the business:
    %!git stripspace
    " Clean up: restore previous search history, and cursor position
    let @/=_s
    call cursor(l, c)
endfunction

function! s:NextTextObject(motion, dir)
  let c = nr2char(getchar())

  if c ==# "b"
      let c = "("
  elseif c ==# "B"
      let c = "{"
  elseif c ==# "r"
      let c = "["
  endif

  exe "normal! ".a:dir.c."v".a:motion.c
endfunction
" }}}

" vim:foldmethod=marker:foldlevel=0
#+end_src

* psql
postgresql 数据库客户端的配置

** cli
#+begin_src conf :tangle ~/.config/pgcli/config :mkdirp "yes"
# vi: ft=dosini
[main]

# Enables context sensitive auto-completion. If this is disabled the all
# possible completions will be listed.
smart_completion = True

# Display the completions in several columns. (More completions will be
# visible.)
wider_completion_menu = False

# Multi-line mode allows breaking up the sql statements into multiple lines. If
# this is set to True, then the end of the statements must have a semi-colon.
# If this is set to False then sql statements can't be split into multiple
# lines. End of line (return) is considered as the end of the statement.
multi_line = False

# If multi_line_mode is set to "psql", in multi-line mode, [Enter] will execute
# the current input if the input ends in a semicolon.
# If multi_line_mode is set to "safe", in multi-line mode, [Enter] will always
# insert a newline, and [Esc] [Enter] or [Alt]-[Enter] must be used to execute
# a command.
multi_line_mode = psql

# Enables expand mode, which is similar to `\x` in psql.
expand = False

# Enables auto expand mode, which is similar to `\x auto` in psql.
auto_expand = False

# If set to True, table suggestions will include a table alias
generate_aliases = False

# log_file location.
# In Unix/Linux: ~/.config/pgcli/log
# In Windows: %USERPROFILE%\AppData\Local\dbcli\pgcli\log
# %USERPROFILE% is typically C:\Users\{username}
log_file = default

# keyword casing preference. Possible values "lower", "upper", "auto"
keyword_casing = auto

# casing_file location.
# In Unix/Linux: ~/.config/pgcli/casing
# In Windows: %USERPROFILE%\AppData\Local\dbcli\pgcli\casing
# %USERPROFILE% is typically C:\Users\{username}
casing_file = default

# If generate_casing_file is set to True and there is no file in the above
# location, one will be generated based on usage in SQL/PLPGSQL functions.
generate_casing_file = False

# Casing of column headers based on the casing_file described above
case_column_headers = True

# history_file location.
# In Unix/Linux: ~/.config/pgcli/history
# In Windows: %USERPROFILE%\AppData\Local\dbcli\pgcli\history
# %USERPROFILE% is typically C:\Users\{username}
history_file = default

# Default log level. Possible values: "CRITICAL", "ERROR", "WARNING", "INFO"
# and "DEBUG". "NONE" disables logging.
log_level = INFO

# Order of columns when expanding * to column list
# Possible values: "table_order" and "alphabetic"
asterisk_column_order = table_order

# Whether to qualify with table alias/name when suggesting columns
# Possible values: "always", never" and "if_more_than_one_table"
qualify_columns = if_more_than_one_table

# When no schema is entered, only suggest objects in search_path
search_path_filter = False

# Default pager.
# By default 'PAGER' environment variable is used
# pager = less -SRXF

# Timing of sql statments and table rendering.
timing = True

# Table format. Possible values: psql, plain, simple, grid, fancy_grid, pipe,
# ascii, double, github, orgtbl, rst, mediawiki, html, latex, latex_booktabs,
# textile, moinmoin, jira, vertical, tsv, csv.
# Recommended: psql, fancy_grid and grid.
table_format = psql

# Syntax Style. Possible values: manni, igor, xcode, vim, autumn, vs, rrt,
# native, perldoc, borland, tango, emacs, friendly, monokai, paraiso-dark,
# colorful, murphy, bw, pastie, paraiso-light, trac, default, fruity
syntax_style = default

# Keybindings:
# When Vi mode is enabled you can use modal editing features offered by Vi in the REPL.
# When Vi mode is disabled emacs keybindings such as Ctrl-A for home and Ctrl-E
# for end are available in the REPL.
vi = False

# Error handling
# When one of multiple SQL statements causes an error, choose to either
# continue executing the remaining statements, or stopping
# Possible values "STOP" or "RESUME"
on_error = STOP

# Set threshold for row limit prompt. Use 0 to disable prompt.
row_limit = 1000

# Skip intro on startup and goodbye on exit
less_chatty = False

# Postgres prompt
# \u - Username
# \h - Hostname of the server
# \d - Database name
# \n - Newline
prompt = '\u@\h:\d> '

# Number of lines to reserve for the suggestion menu
min_num_menu_lines = 4

# Character used to left pad multi-line queries to match the prompt size.
multiline_continuation_char = ''

# The string used in place of a null value.
null_string = '<null>'

# Custom colors for the completion menu, toolbar, etc.
[colors]
Token.Menu.Completions.Completion.Current = 'bg:#ffffff #000000'
Token.Menu.Completions.Completion = 'bg:#008888 #ffffff'
Token.Menu.Completions.Meta.Current = 'bg:#44aaaa #000000'
Token.Menu.Completions.Meta = 'bg:#448888 #ffffff'
Token.Menu.Completions.MultiColumnMeta = 'bg:#aaffff #000000'
Token.Menu.Completions.ProgressButton = 'bg:#003333'
Token.Menu.Completions.ProgressBar = 'bg:#00aaaa'
Token.SelectedText = '#ffffff bg:#6666aa'
Token.SearchMatch = '#ffffff bg:#4444aa'
Token.SearchMatch.Current = '#ffffff bg:#44aa44'
Token.Toolbar = 'bg:#222222 #aaaaaa'
Token.Toolbar.Off = 'bg:#222222 #888888'
Token.Toolbar.On = 'bg:#222222 #ffffff'
Token.Toolbar.Search = 'noinherit bold'
Token.Toolbar.Search.Text = 'nobold'
Token.Toolbar.System = 'noinherit bold'
Token.Toolbar.Arg = 'noinherit bold'
Token.Toolbar.Arg.Text = 'nobold'
Token.Toolbar.Transaction.Valid = 'bg:#222222 #00ff5f bold'
Token.Toolbar.Transaction.Failed = 'bg:#222222 #ff005f bold'

# Named queries are queries you can execute by name.
[named queries]

# DNS to call by -D option
[alias_dsn]
# example_dsn = postgresql://[user[:password]@][netloc][:port][/dbname]

# Format for number representation
# for decimal "d" - 12345678, ",d" - 12,345,678
# for float "g" - 123456.78, ",g" - 123,456.78
[data_formats]
decimal = ""
float = ""
#+end_src
** rc
#+begin_src conf :tangle ~/.psqlrc :mkdirp "yes"
\set QUIET 1
\timing
\set ON_ERROR_ROLLBACK interactive
\set VERBOSITY verbose
\x auto
\set PROMPT1 '%[%033[1m%]%M/%/%R%[%033[0m%]%# '
\set PROMPT2 ''
\set HISTFILE ~/.psql_history- :DBNAME
\set HISTCONTROL ignoredups
\pset null [null]
\unset QUIET
#+end_src

* shell
** fish

Setup scripts
#+begin_src shell :tangle /tmp/dotfile-script.sh
  echo /usr/local/bin/fish | sudo tee -a /etc/shells # macOS
  chsh -s /usr/bin/fish # Linux

  curl -sL https://git.io/fisher | source
  fisher install jethrokuan/fzf
  fisher install jethrokuan/z
  fisher install franciscolourenco/done
#+end_src

color setting
#+begin_src conf :tangle  ~/.config/fish/config.fish :mkdirp "yes"
set TERM "xterm-256color"

set fish_color_normal normal
set fish_color_command 005fd7
set fish_color_quote 999900
set fish_color_redirection 00afff
set fish_color_end 009900
set fish_color_error ff0000
set fish_color_param 00afff
set fish_color_comment 990000
set fish_color_match --background=brblue
set fish_color_selection white --bold --background=brblack
set fish_color_search_match bryellow --background=brblack
set fish_color_history_current --bold
set fish_color_operator 00a6b2
set fish_color_escape 00a6b2
set fish_color_cwd green
set fish_color_cwd_root red
set fish_color_valid_path --underline
set fish_color_autosuggestion 555 brblack
set fish_color_user brgreen
set fish_color_host normal
set fish_color_cancel -r
set fish_pager_color_completion normal
set fish_pager_color_description B3A06D yellow
set fish_pager_color_prefix white --bold --underline
set fish_pager_color_progress brwhite --background=cyan
#+end_src

asdf setup
#+begin_src conf :tangle (if (eq system-type 'darwin) "~/.config/fish/config.fish" "no") :mkdirp "yes"
source /usr/local/opt/asdf/asdf.fish
#+end_src

#+begin_src conf :tangle (if (eq system-type 'gnu/linux)  "~/.config/fish/config.fish" "no") :mkdirp "yes"
source ~/.asdf/asdf.fish
xmodmap ~/.Xmodmap
#+end_src

starship setup
#+begin_src conf :tangle  ~/.config/fish/config.fish :mkdirp "yes"
starship init fish | source
#+end_src

** starship
#+begin_src toml :tangle ~/.config/starship.toml :mkdirp "yes"
  scan_timeout = 1000
  command_timeout = 1000

  # Disable the newline at the start of the prompt
  add_newline = true

  # Replace the "❯" symbol in the prompt with "➜"
  [character]                            # The name of the module we are configuring is "character"
  success_symbol = "[➜](bold green)"     # The "success_symbol" segment is being set to "➜" with the color "bold green"

  [battery]
  full_symbol = "🔋"
  charging_symbol = "⚡️"
  discharging_symbol = "💀"

  [ruby]
  symbol = "🔺 "

  [git_status]
  conflicted = "🏳"
  ahead = "🏎💨"
  behind = "😰"
  diverged = "😵"
  untracked = "🤷‍"
  stashed = "📦"
  modified = "📝"
  staged = '[++\($count\)](green)'
  renamed = "👅"
  deleted = "🗑"

  [git_branch]
  symbol = "🌱 "
#+end_src
** welcome memssage
remove last login message by touch this dot file
#+begin_src conf :tangle ~/.hushlogin

#+end_src

#+begin_src shell :tangle ~/.config/fish/functions/fish_greeting.fish :mkdirp "yes"
function fish_greeting

end
#+end_src
** alias
fish shell 使用函数来实现 alias
#+begin_src shell :tangle ~/.config/fish/functions/cat.fish :mkdirp "yes"
  function cat
    bat $argv
  end
#+end_src

#+begin_src shell :tangle ~/.config/fish/functions/vim.fish :mkdirp "yes"
  function vim
    nvim $argv
  end
#+end_src

#+begin_src shell :tangle ~/.config/fish/functions/ls.fish :mkdirp "yes"
  function ls
    exa $argv
  end
#+end_src

#+begin_src shell :tangle ~/.config/fish/functions/gita.fish :mkdirp "yes"
  function gita
    python3 -m gita $argv
  end
#+end_src

* Xresources
** 屏幕设置
#+begin_src conf :tangle (if (eq system-type 'gnu/linux) "~/.Xresources" "no")
Xft.dpi:       96
Xft.antialias: true
Xft.hinting:   true
Xft.rgba:      rgb
Xft.autohint:  false
Xft.hintstyle: hintslight
Xft.lcdfilter: lcddefault
#+end_src

** XTerm 设置

#+begin_src conf :tangle (if (eq system-type 'gnu/linux) "~/.Xresources" "no")
XTerm*background:        #222D31
XTerm*foreground:        #d8d8d8
XTerm*pointerColor:      #1ABB9B
XTerm*faceName:          Fixed
XTerm*faceSize:          11
XTerm*reverseVideo:      on
XTerm*selectToClipboard: true
#+end_src

** 颜色设置
#+begin_src conf :tangle (if (eq system-type 'gnu/linux) "~/.Xresources" "no")
*background:                      #222D31
*foreground:                      #d8d8d8
*fading:                          8
*fadeColor:                       black
*cursorColor:                     #1ABB9B
*pointerColorBackground:          #2B2C2B
*pointerColorForeground:          #16A085

!! black dark/light
*color0:                          #222D31
*color8:                          #585858

!! red dark/light
*color1:                          #ab4642
*color9:                          #ab4642

!! green dark/light
*color2:                          #7E807E
*color10:                         #8D8F8D

!! yellow dark/light
*color3:                          #f7ca88
*color11:                         #f7ca88

!! blue dark/light
*color4:                          #7cafc2
*color12:                         #7cafc2

!! magenta dark/light
*color5:                          #ba8baf
*color13:                         #ba8baf

!! cyan dark/light
*color6:                          #1ABB9B
*color14:                         #1ABB9B

!! white dark/light
*color7:                          #d8d8d8
*color15:                         #f8f8f8

Xcursor.theme:                    xcursor-breeze
Xcursor.size:                     0
#+end_src

** URxvt 设置
#+begin_src conf :tangle (if (eq system-type 'gnu/linux) "~/.Xresources" "no")
URxvt*font:                       xft:SauceCodePro Nerd Font Mono:pixelsize=21:minspace=False, xft:DejaVu Sans:pixelsize=14, xft:Monaco:style=regular:pixelsize=13:antialias=true,hinting=true, xft:dejavu sans mono:pixelsize=13:antialias=true,hinting=true, xft:Twitter Color Emoji:pixelsize=14, xft:NotoEmoji Nerd Font Mono:pixelsize=14, xft:Symbola
URxvt*boldFont:                   xft:SauceCodePro Nerd Font Mono:pixelsize=21:minspace=False, xft:DejaVu Sans:pixelsize=14, xft:Monaco:style=regular:pixelsize=13:antialias=true,hinting=true, xft:dejavu sans mono:pixelsize=13:antialias=true,hinting=true
URxvt*letterSpace:                0
! alternative font settings with 'terminus':
! URxvt.font:      -xos4-terminus-medium-r-normal--16-160-72-72-c-80-iso10646-1
! URxvt.bold.font: -xos4-terminus-bold-r-normal--16-160-72-72-c-80-iso10646-1
!! terminus names see end of file!

URxvt.depth:                      32
URxvt.background:                 [100]#222D31
URxvt*scrollBar:                  false
URxvt*mouseWheelScrollPage:       false
URxvt*cursorBlink:                true
URxvt*background:                 black
URxvt*foreground:                 grey
URxvt*saveLines:                  5000

! for 'fake' transparency (without Compton) uncomment the following three lines
! URxvt*inheritPixmap:            true
! URxvt*transparent:              true
! URxvt*shading:                  138

! Normal copy-paste keybindings without perls
URxvt.iso14755:                   false
URxvt.keysym.Mod4-v:                 eval:paste_clipboard
URxvt.keysym.Mod4-c:                 eval:selection_to_clipboard
URxvt.keysym.Mod4-l:              command:\033c
URxvt.keysym.Mod4-k:                    echo -ne '\\033c'\n

!Xterm escape codes, word by word movement
URxvt.keysym.Control-Left:        \033[1;5D
URxvt.keysym.Shift-Control-Left:  \033[1;6D
URxvt.keysym.Control-Right:       \033[1;5C
URxvt.keysym.Shift-Control-Right: \033[1;6C
URxvt.keysym.Control-Up:          \033[1;5A
URxvt.keysym.Shift-Control-Up:    \033[1;6A
URxvt.keysym.Control-Down:        \033[1;5B
URxvt.keysym.Shift-Control-Down:  \033[1;6B
#+end_src

* tmux
** basic
#+begin_src conf :tangle "~/.tmux.conf")
# cat << ►_◄ > /dev/null
# 上面这行可以用来检测特殊字符能否在当前环境被显示

# -- general -------------------------------------------------------------------

setw -g xterm-keys on

set -sg repeat-time 600                   # increase repeat timeout

set -g prefix2 C-a                        # GNU-Screen compatible prefix
bind C-a send-prefix -2                   # 默认前缀是 c-a

# edit configuration
bind e new-window -n '~/.tmux.conf' '${EDITOR:-vim} ~/.tmux.conf && tmux source ~/.tmux.conf && tmux display "~/.tmux.conf sourced"'

# see https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
if 'which -s reattach-to-user-namespace' 'set -g default-command "tmux rename-window initializing; tmux set -w automatic-rename; reattach-to-user-namespace $SHELL -l"'

# -- display -------------------------------------------------------------------

set -g base-index 1         # start windows numbering at 1
setw -g pane-base-index 1   # make pane numbering consistent with windows

setw -g automatic-rename on # rename window to reflect current program
# renumber windows when a window is closed
set -g renumber-windows on

set -g set-titles on                        # set terminal title
set -g set-titles-string '#h ❐ #S ● #I #W'  # 显示的title

set -g display-panes-time 800 # slightly longer pane indicators display time

# 24 hour clock
setw -g clock-mode-style 24

# clear both screen and history
bind -n C-l send-keys C-l \; run 'tmux clear-history'

# activity
set -g monitor-activity on
set -g visual-activity off

# -- navigation ----------------------------------------------------------------

# create new session
bind C-c new-session # 创建新的 session

# find session
bind C-f command-prompt -p find-session 'switch-client -t %%' # 查找 session

bind - splitw -v # 分割成上下两个窗口
bind | splitw -h # 分割成左右两个窗口

# pane navigation vim 键位的导航在 pane 之间
bind -r h select-pane -L  # move left
bind -r j select-pane -D  # move down
bind -r k select-pane -U  # move up
bind -r l select-pane -R  # move right
bind > swap-pane -D       # swap current pane with the next one
bind < swap-pane -U       # swap current pane with the previous one

# maximize current pane 最大化当前 pane
bind + run 'cut -c3- ~/.tmux.conf | sh -s maximize_pane'

# pane resizing 大写的 vim 键位， 调整 pane 尺寸
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# window navigation
bind -r C-h previous-window # select previous window
bind -r C-l next-window     # select next window
bind Space last-window      # move to last active window

# toggle mouse
bind m run "cut -c3- ~/.tmux.conf | sh -s toggle_mouse"


# copy to Mac OSX pasteboard
if 'which -s reattach-to-user-namespace' 'bind y run "tmux save-buffer - | reattach-to-user-namespace pbcopy"'

# 用户自定义的模块
if '[ -f ~/.tmux.conf.local ]' 'source ~/.tmux.conf.local'
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com/user/plugin'
# set -g @plugin 'git@bitbucket.com/user/plugin'
# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
#+end_src

** local
#+begin_src conf :tangle "~/.tmux.conf.local")
# tmux theme, colors and status line
# available themes:
#   - powerline (a powerline inspired theme)
#   - powerline_patched_font (a powerline inspired theme using a patched font)
#tmux_conf_theme=powerline # powerline 的主题
set-option -g status-position top
# set -g status-right ""
set -g status-right '#{prefix_highlight} | %a %Y-%m-%d %H:%M'

#### COLOUR (Solarized light)

# default statusbar colors
set-option -g status-bg white #base2
set-option -g status-fg yellow #yellow
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg brightyellow #base00
set-window-option -g window-status-bg default
#set-window-option -g window-status-attr dim

# active window title colors
set-window-option -g window-status-current-fg brightred #orange
set-window-option -g window-status-current-bg default
#set-window-option -g window-status-current-attr bright

# pane border
set-option -g pane-border-fg white #base2
set-option -g pane-active-border-fg brightcyan #base1

# message text
set-option -g message-bg white #base2
set-option -g message-fg brightred #orange

# pane number display
set-option -g display-panes-active-colour blue #blue
set-option -g display-panes-colour brightred #orange

# clock
set-window-option -g clock-mode-colour green #green

# bell
set-window-option -g window-status-bell-style fg=white,bg=red #base2, red
#+end_src

* sway

#+begin_src conf :tangle (if (eq system-type 'gnu/linux) "~/.config/chromium-flags.conf" "no") :mkdirp
  --enable-features=UseOzonePlatform
  --ozone-platform=wayland
#+end_src

#+begin_src conf :tangle (if (eq system-type 'gnu/linux) "~/.config/sway/config" "no") :mkdirp
  # Logo key. Use Mod1(super) for Alt.
  set $mod Mod4
  # Home row direction keys, like vim
  set $left h
  set $down j
  set $up k
  set $right l
  # Your preferred terminal emulator
  set $term alacritty
  # Your preferred application launcher
  # Note: pass the final command to swaymsg so that the resulting window can be opened
  # on the original workspace that the command was run on.
  #set $menu dmenu_path | dmenu | xargs swaymsg exec --
  set $menu wofi --show=drun --lines=5 --prompt=""
  # Default wallpaper (more resolutions are available in /usr/share/backgrounds/sway/)
  output * bg /usr/share/backgrounds/sway/Sway_Wallpaper_Blue_1920x1080.png fill

  ### Key bindings
  #
  # Basics:
  #
  # Start a terminal
  bindsym $mod+Return exec $term

  # Kill focused window
  bindsym $mod+Shift+q kill

  # Start your launcher
  bindsym $mod+d exec $menu

  # Drag floating windows by holding down $mod and left mouse button.
  # Resize them with right mouse button + $mod.
  # Despite the name, also works for non-floating windows.
  # Change normal to inverse to use left mouse button for resizing and right
  # mouse button for dragging.
  floating_modifier $mod normal

  # Reload the configuration file
  bindsym $mod+Shift+c reload

  # Exit sway (logs you out of your Wayland session)
  bindsym $mod+Shift+e exec swaynag -t warning -m 'You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session.' -b 'Yes, exit sway' 'swaymsg exit'
  #
  # Moving around:
  #
  # Move your focus around
  bindsym $mod+$left focus left
  bindsym $mod+$down focus down
  bindsym $mod+$up focus up
  bindsym $mod+$right focus right
  # Or use $mod+[up|down|left|right]
  bindsym $mod+Left focus left
  bindsym $mod+Down focus down
  bindsym $mod+Up focus up
  bindsym $mod+Right focus right

  # Move the focused window with the same, but add Shift
  bindsym $mod+Shift+$left move left
  bindsym $mod+Shift+$down move down
  bindsym $mod+Shift+$up move up
  bindsym $mod+Shift+$right move right
  # Ditto, with arrow keys
  bindsym $mod+Shift+Left move left
  bindsym $mod+Shift+Down move down
  bindsym $mod+Shift+Up move up
  bindsym $mod+Shift+Right move right
  #
  # Workspaces:
  #
  # Switch to workspace
  bindsym $mod+1 workspace number 1
  bindsym $mod+2 workspace number 2
  bindsym $mod+3 workspace number 3
  bindsym $mod+4 workspace number 4
  bindsym $mod+5 workspace number 5
  bindsym $mod+6 workspace number 6
  bindsym $mod+7 workspace number 7
  bindsym $mod+8 workspace number 8
  bindsym $mod+9 workspace number 9
  bindsym $mod+0 workspace number 10
  # Move focused container to workspace
  bindsym $mod+Shift+1 move container to workspace number 1
  bindsym $mod+Shift+2 move container to workspace number 2
  bindsym $mod+Shift+3 move container to workspace number 3
  bindsym $mod+Shift+4 move container to workspace number 4
  bindsym $mod+Shift+5 move container to workspace number 5
  bindsym $mod+Shift+6 move container to workspace number 6
  bindsym $mod+Shift+7 move container to workspace number 7
  bindsym $mod+Shift+8 move container to workspace number 8
  bindsym $mod+Shift+9 move container to workspace number 9
  bindsym $mod+Shift+0 move container to workspace number 10
  # Note: workspaces can have any name you want, not just numbers.
  # We just use 1-10 as the default.
  #
  # Layout stuff:
  #
  # You can "split" the current object of your focus with
  # $mod+b or $mod+v, for horizontal and vertical splits
  # respectively.
  bindsym $mod+b splith
  bindsym $mod+v splitv

  # Switch the current container between different layout styles
  bindsym $mod+s layout stacking
  bindsym $mod+w layout tabbed
  bindsym $mod+e layout toggle split

  # Make the current focus fullscreen
  bindsym $mod+f fullscreen

  # Toggle the current focus between tiling and floating mode
  bindsym $mod+Shift+space floating toggle

  # Swap focus between the tiling area and the floating area
  bindsym $mod+space focus mode_toggle

  # Move focus to the parent container
  bindsym $mod+a focus parent
  #
  # Scratchpad:
  #
  # Sway has a "scratchpad", which is a bag of holding for windows.
  # You can send windows there and get them back later.

  # Move the currently focused window to the scratchpad
  bindsym $mod+Shift+minus move scratchpad

  # Show the next scratchpad window or hide the focused scratchpad window.
  # If there are multiple scratchpad windows, this command cycles through them.
  bindsym $mod+minus scratchpad show
  #
  # Resizing containers:
  #
  mode "resize" {
  # left will shrink the containers width
  # right will grow the containers width
  # up will shrink the containers height
  # down will grow the containers height
  bindsym $left resize shrink width 10px
  bindsym $down resize grow height 10px
  bindsym $up resize shrink height 10px
  bindsym $right resize grow width 10px

  # Ditto, with arrow keys
  bindsym Left resize shrink width 10px
  bindsym Down resize grow height 10px
  bindsym Up resize shrink height 10px
  bindsym Right resize grow width 10px

  # Return to default mode
  bindsym Return mode "default"
  bindsym Escape mode "default"
  }
  bindsym $mod+r mode "resize"

  #
  # Status Bar:
  #
  # Read `man 5 sway-bar` for more information about this section.
  bar {
  position top

  # When the status_command prints a new line to stdout, swaybar updates.
  # The default just shows the current date and time.
  # status_command while date +'%Y-%m-%d %l:%M:%S %p'; do sleep 1; done
  swaybar_command waybar
  colors {
  statusline #ffffff
  background #323232
  inactive_workspace #32323200 #32323200 #5c5c5c
  }
  }

  input "type:keyboard" {
  # or input <identifier>
  xkb_options ctrl:nocaps
  }

  include /etc/sway/config.d/*

#+end_src
* hammerspoon
** init
#+begin_src sh
  ln -s ~/ownCloud/Config/Spoons ~/.hammerspoon
#+end_src

#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/init.lua" "no") :mkdirp "yes"
  hs.loadSpoon("AClock")
  hs.loadSpoon("WinWin")
  hs.loadSpoon("WindowScreenLeftAndRight")
  hs.loadSpoon("WindowHalfsAndThirds")

  require "modules/config"
  require "modules/app"
  require "modules/window"
  require "modules/screen"
  require "modules/key"
  require "modules/dashboard"
  require "modules/layout"
  require "modules/react"

  hs.hotkey.bind(hyper, 'h', function()
                    hs.alert.show("Hello World!")
  end)

  hs.hotkey.bind(hyper, 'r', function()
                    hs.reload()
  end)

  hs.alert.show("Config loaded")
#+end_src

** app
#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/modules/app.lua" "no") :mkdirp "yes"
hs.hotkey.bind(hyper, 'i', function()
                  hs.application.launchOrFocus('Terminal')
end)

hs.hotkey.bind(hyper, 'f', function()
                  hs.application.launchOrFocus('Finder')
end)

hs.hotkey.bind(hyper, 's', function()
                  hs.application.launchOrFocus('Slack')
end)

hs.hotkey.bind(hyper, 'e', function()
                  hs.application.launchOrFocus('Emacs')
end)

hs.hotkey.bind(hyper, 't', function()
                  spoon.AClock:toggleShow()
end)

#+end_src
** config
#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/modules/config.lua" "no") :mkdirp "yes"
hyper = {'cmd', 'alt', 'ctrl'}
hyperShift = {'alt', 'cmd', 'shift'}
macbook_monitor = "Color LCD"
dostyle_monitor = "DM320QC"
lg_4k_monitor = "LV273HUPR"
portable_monitor = "CLUO FHD"
lg_ultrawide_monitor = "LG ULTRAWIDE"
#+end_src
** key
#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/modules/key.lua" "no")  :mkdirp "yes"
function showKeyPress(tap_event)
   local duration = 1.5  -- popup duration
   local modifiers = ""  -- key modifiers string representation
   local flags = tap_event:getFlags()
   local character = hs.keycodes.map[tap_event:getKeyCode()]
   -- we only want to read special characters via getKeyCode, so we use this subset of hs.keycodes.map
   local special_chars = {
      ["f1"] = true, ["f2"] = true, ["f3"] = true, ["f4"] = true,
      ["f5"] = true, ["f6"] = true, ["f7"] = true, ["f8"] = true,
      ["f9"] = true, ["f10"] = true, ["f11"] = true, ["f12"] = true,
      ["f13"] = true, ["f14"] = true, ["f15"] = true, ["f16"] = true,
      ["f17"] = true, ["f18"] = true, ["f19"] = true, ["f20"] = true,
      ["pad"] = true, ["pad*"] = true, ["pad+"] = true, ["pad/"] = true,
      ["pad-"] = true, ["pad="] = true, ["pad0"] = true, ["pad1"] = true,
      ["pad2"] = true, ["pad3"] = true, ["pad4"] = true, ["pad5"] = true,
      ["pad6"] = true, ["pad7"] = true, ["pad8"] = true, ["pad9"] = true,
      ["padclear"] = true, ["padenter"] = true, ["return"] = true,
      ["tab"] = true, ["space"] = true, ["delete"] = true, ["escape"] = true,
      ["help"] = true, ["home"] = true, ["pageup"] = true,
      ["forwarddelete"] = true, ["end"] = true, ["pagedown"] = true,
      ["left"] = true, ["right"] = true, ["down"] = true, ["up"] = true
   }

   -- if we have a simple character (no modifiers), we want a shorter popup duration.
   if (not flags.shift and not flags.cmd and not flags.alt and not flags.ctrl) then
      duration = 0.3
   end

   -- we want to get regular characters via getCharacters as it "cleans" the key for us
   -- (e.g. for a "⇧-5" keypress we want to show "⇧-%").
   if special_chars[character] == nil then
      character = tap_event:getCharacters(true)
      if flags.shift then
         character = string.lower(character)
      end
   end

   local pretty_characters = {
      ["return"]  = "⏎",
      ["delete"]  = "⌫",
      ["escape"]  = "⎋",
      ["space"]   = "SPC",
      ["up"]      = "↑",
      ["down"]    = "↓",
      ["left"]    = "←",
      ["right"]   = "→",
      ["tab"]     = "⇥"
   }

   character = pretty_characters[character] or character

   -- get modifiers' string representation
   if flags.ctrl then
      modifiers = modifiers .. "⌃-"
   end
   if flags.cmd then
      modifiers = modifiers .. "⌘-"
   end
   if flags.shift then
      modifiers = modifiers .. "⇧-"
   end
   if flags.alt then
      modifiers = modifiers .. "⌥-"
   end

   key_char = modifiers .. character
   display_key_char(key_char)
end

function display_key_char(key_char)
   build_exist_key_string(key_char)

   if not key_draw then
      create_draw(exist_key_string)
   else
      destroy_draw(key_draw)
      create_draw(exist_key_string)
   end
   key_draw:show()
   reset_key_display_timer()
end

function build_exist_key_string(string)
   local max_display_key_command_length = 8
   key_array = key_array or {}

   if #key_array > max_display_key_command_length then
      table.remove(key_array, 1)
   end

   key_array[#key_array + 1] = string
   exist_key_string = table.concat(key_array, ' ')
end

function reset_key_display_timer()
   if key_display_timer then
      key_display_timer:stop()
   end
   key_display_timer = hs.timer.doAfter(2, function() destroy_draw(key_draw) key_array = {} end)
end

function create_draw(content)
   local mainRes = hs.mouse.getCurrentScreen():fullFrame() -- e.g w:1920 h:1080
   local font_size = 40
   local styledString = hs.styledtext.new(
      content,
      {
         font = { name = "Fira Mono", size = font_size },
         color = hs.drawing.color.hammerspoon.osx_green, --hs.drawing.color.x11.silver,
         paragraphStyle = { alignment = "center" }
      }
   )
   local w = mainRes.w * 2 / 3
   local h = font_size * 1.5
   local x = mainRes.w / 2 - w / 3
   local y = mainRes.y + h + w / 2
   local keyFrame = hs.geometry.rect(x, y, w, h)
   key_draw = hs.drawing.text(keyFrame, styledString)
   key_draw:setLevel(hs.drawing.windowLevels.overlay)
end

function destroy_draw(draw)
   if draw then
      key_draw:delete()
      key_draw = nil
   end
end

local key_tap = hs.eventtap.new(
   {hs.eventtap.event.types.keyDown},
   showKeyPress
)

-- Enable/Disable Keypress Show Mode with "hyper-p"
k = hs.hotkey.modal.new(hyper, 'P')
function k:entered()
   hs.alert.show("Enabling Keypress Show Mode", 1.5)
   key_tap:start()
end
function k:exited()
   hs.alert.show("Disabling Keypress Show Mode", 1.5)
end
k:bind(hyper, 'P', function()
          key_tap:stop()
          k:exit()
end)

#+end_src
** layout
#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/modules/layout.lua" "no") :mkdirp "yes"
top_half    = hs.geometry.unitrect(0,0,1,0.5)
buttom_half = hs.geometry.unitrect(0,0.5,1,0.5)
left_half   = hs.layout.left50
right_half  = hs.layout.right50
maximized   = hs.layout.maximized


local reading_layout= {
  {"Emacs",         nil, macbook_monitor, maximized, nil, nil},
  {"Google Chrome", nil, main_monitor,    right_half,   nil, nil},
  {"iBooks",        nil, main_monitor,    left_half,    nil, nil},
  {"Telegram",      nil, second_monitor,  top_half,    nil, nil},
  {"Mail",          nil, second_monitor,  buttom_half,   nil, nil},
}

local coding_layout= {
  {"Terminal",      nil, macbook_monitor, maximized, nil, nil},
  {"Google Chrome", nil, main_monitor,    left_half,    nil, nil},
  {"Emacs",         nil, main_monitor,    right_half,   nil, nil},
  {"Station",       nil, second_monitor,  top_half,    nil, nil},
  {"TablePlus",     nil, second_monitor,  buttom_half,   nil, nil},
}

local writing_layout= {
  {"Emacs",         nil, main_monitor,    maximized, nil, nil},
  {"Google Chrome", nil, second_monitor,  maximized, nil, nil},
  {"IINA",          nil, macbook_monitor, maximized, nil, nil},
}

hs.hotkey.bind(hyper, '1', function()
  hs.application.launchOrFocus('Emacs')
  hs.application.launchOrFocus('Google Chrome')
  hs.application.launchOrFocus('iBooks')
  hs.application.launchOrFocus('Telegram')
  hs.application.launchOrFocus('Mail')

  hs.layout.apply(reading_layout)
end)

hs.hotkey.bind(hyper, '2', function()
  hs.application.launchOrFocus('Terminal')
  hs.application.launchOrFocus('Google Chrome')
  hs.application.launchOrFocus('Emacs')
  hs.application.launchOrFocus('Station')
  hs.application.launchOrFocus('TablePlus')

  hs.layout.apply(coding_layout)
end)

hs.hotkey.bind(hyper, '3', function()
  hs.application.launchOrFocus('Google Chrome')
  hs.application.launchOrFocus('Emacs')
  hs.application.launchOrFocus('IINA')

  hs.layout.apply(writing_layout)
end)
#+end_src
** react
#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/modules/react.lua" "no")  :mkdirp "yes"
function applicationWatcher(appName, eventType, appObject)
   if (eventType == hs.application.watcher.activated) then
      if (appName == "Terminal") then
         appObject:selectMenuItem({"Window", "Bring All to Front"})
      elseif (appName == "Finder") then
         appObject:selectMenuItem({"Window", "Bring All to Front"})
      elseif (appName == "Google Chrome") then
         appObject:selectMenuItem({"Window", "Bring All to Front"})
      end
   end
end

appWatcher = hs.application.watcher.new(applicationWatcher)
appWatcher:start()

caffeine = hs.menubar.new()
function setCaffeineDisplay(state)
   if state then
      caffeine:setTitle("AWAKE")
   else
      caffeine:setTitle("SLEEPY")
   end
end

function caffeineClicked()
   setCaffeineDisplay(hs.caffeinate.toggle("displayIdle"))
end

if caffeine then
   caffeine:setClickCallback(caffeineClicked)
   setCaffeineDisplay(hs.caffeinate.get("displayIdle"))
end

#+end_src
** screen
#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/modules/screen.lua" "no") :mkdirp "yes"
function focus_other_screen() -- focuses the other screen
   local current_screen = hs.mouse.getCurrentScreen()
   local nextScreen = current_screen:next()
   local rect = nextScreen:fullFrame()
   local center = hs.geometry.rectMidPoint(rect)
   hs.mouse.setAbsolutePosition(center)
   return nextScreen
end

function get_window_under_mouse() -- from https://gist.github.com/kizzx2/e542fa74b80b7563045a
   local my_pos = hs.geometry.new(hs.mouse.getAbsolutePosition())
   local my_screen = hs.mouse.getCurrentScreen()
   return hs.fnutils.find(hs.window.orderedWindows(), function(w)
                             return my_screen == w:screen() and my_pos:inside(w:frame())
   end)
end

function activate_other_screen()
   local next_screen = focus_other_screen()
   local win = get_window_under_mouse()
   win:focus()
   redrawBorder()
end

hs.hotkey.bind(hyper, 'o', function()
                  activate_other_screen()
end)

function redrawBorder()
   win = hs.window.focusedWindow()
   if not win then
      return
   end
   top_left = win:topLeft()
   size = win:size()
   if global_border ~= nil then global_border:delete() end
   global_border = hs.drawing.rectangle(hs.geometry.rect(top_left['x'], top_left['y'], size['w'], size['h']))
   global_border:setStrokeColor({ ["red"] = 1, ["blue"] = 0, ["green"] = 0, ["alpha"] = 0.8 })
   global_border:setFill(false)
   global_border:setStrokeWidth(8)
   global_border:show()
   hs.timer.doAfter(1, function() global_border:hide() end)
end

function mouseHighlight()
   -- Delete an existing highlight if it exists
   if mouseCircle then
      mouseCircle:delete()
      if mouseCircleTimer then
         mouseCircleTimer:stop()
      end
   end
   -- Get the current co-ordinates of the mouse pointer
   mousepoint = hs.mouse.getAbsolutePosition()
   hs.alert.show(mousepoint)
   -- Prepare a big red circle around the mouse pointer
   mouseCircle = hs.drawing.circle(hs.geometry.rect(mousepoint.x-40, mousepoint.y-40, 80, 80))
   mouseCircle:setStrokeColor({ ["red"] = 1, ["blue"] = 0, ["green"] = 0, ["alpha"] = 1 })
   mouseCircle:setFill(false)
   mouseCircle:setStrokeWidth(5)
   mouseCircle:show()

   -- Set a timer to delete the circle after 3 seconds
   mouseCircleTimer = hs.timer.doAfter(3, function() mouseCircle:delete() end)
end

#+end_src
** window
#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/modules/window.lua" "no")  :mkdirp "yes"
-- hs.window.animationDuration = 0
spoon.WindowScreenLeftAndRight:bindHotkeys({
      screen_left = { hyperShift, "Left" },
      screen_right= { hyperShift, "Right" },
})

spoon.WindowHalfsAndThirds:bindHotkeys({
      left_half   = { hyper, "Left" },
      right_half  = { hyper, "Right" },
      top_half    = { hyper, "Up" },
      bottom_half = { hyper, "Down" },
})

-- hs.hotkey.bind(hyper, "m", function()
--   local win = hs.window.focusedWindow()
--   win:maximize()
-- end)
#+end_src
** TODO drag terminal
https://github.com/Braden1996/BradensPoon/blob/master/spoons/drag_terminals.lua
#+begin_src lua
local merge = pl.tablex.merge
local fromHexAlpha = poon.utils.colors.fromHexAlpha

local color = fromHexAlpha('#81ecec', 0.5)
local endColor = fromHexAlpha('#00cec9', 0.5)
local strokeColor = merge(color, { alpha=1 }, true)

local rectanglePreview = hs.drawing.rectangle(hs.geometry.rect(0, 0, 0, 0))
rectanglePreview:setStrokeWidth(2)
rectanglePreview:setStrokeColor(strokeColor)
rectanglePreview:setFillGradient(color, endColor, 45)
rectanglePreview:setRoundedRectRadii(2, 2)
rectanglePreview:setStroke(true):setFill(true)
rectanglePreview:setLevel("floating")

local function openIterm()
  local frame = rectanglePreview:frame()
  local createItermWithBounds = string.format([[
    if application "iTerm" is not running then
      launch application "iTerm"
    end if
    tell application "iTerm"
      set newWindow to (create window with default profile)
      set the bounds of newWindow to {%i, %i, %i, %i}
    end tell
  ]], frame.x, frame.y, frame.x + frame.w, frame.y + frame.h)
  hs.osascript.applescript(createItermWithBounds)
end

local fromPoint = nil

local drag_event = hs.eventtap.new(
  { hs.eventtap.event.types.mouseMoved },
  function(e)
    local toPoint = hs.mouse.getAbsolutePosition()
    local newFrame = hs.geometry.new({
      x1 = fromPoint.x,
      y1 = fromPoint.y,
      x2 = toPoint.x,
      y2 = toPoint.y,
    })
    rectanglePreview:setFrame(newFrame)

    return nil
  end
)

local flags_event = hs.eventtap.new(
  { hs.eventtap.event.types.flagsChanged },
  function(e)
    local flags = e:getFlags()
    if flags.ctrl and flags.shift then
      fromPoint = hs.mouse.getAbsolutePosition()
      local startFrame = hs.geometry.rect(fromPoint.x, fromPoint.y, 0, 0)
      rectanglePreview:setFrame(startFrame)
      drag_event:start()
      rectanglePreview:show()
    elseif fromPoint ~= nil then
      fromPoint = nil
      drag_event:stop()
      rectanglePreview:hide()
      openIterm()
    end
    return nil
  end
)
flags_event:start()
#+end_src
** Dashboard
#+begin_src lua :tangle (if (eq system-type 'darwin) "~/.hammerspoon/modules/dashboard.lua" "no")
  hs.hotkey.bind(hyper, 'y', function()
                    if not dashboardView then
                       generate_view()
                       local webcontent = html_dashboard(generate_result())
                       dashboardView:html(webcontent)
                       dashboardView:show()
                    else
                       dashboardView:delete()
                       dashboardView:hide()
                       dashboardView = nil
                    end
  end)

  function generate_result()
     local items = {
        todolist = {'cat ~/Documents/org/todo.org  | grep "* TODO" | sed "s/TODO/""/g"', "col-todo-list"},
        roamlist = {'ls ~/Documents/org/roam', "col-roam-list"}
     }

     result = generate_html_row_div(items)
     return result
  end

  function generate_html_row_div(tb)
     result = '<div class="row" style="min-height:100px">'
     for k, v in pairs(tb) do
        result = result .. '<div class="col-sm ' .. v[2] .. '">'
        result = result .. '<h4>' .. k .. '</h4>'
        result = result .. get_command_result(v[1]) .. '</div>'
     end
     result = result .. '</div>'
     return result
  end

  function get_command_result(c)
     local handle = io.popen(c)
     local result = handle:read("*a")
     handle:close()
     return result.gsub(result, "\n", "<br/>")
  end

  function generate_view()
     local cscreen = hs.screen.mainScreen()
     local cres = cscreen:fullFrame()

     dashboardView = hs.webview.new({x=0, y=0, w=0, h=0})
     dashboardView:windowTitle("Dashboard")
     dashboardView:windowStyle("utility")
     dashboardView:allowGestures(true)
     dashboardView:allowNewWindows(false)
     dashboardView:level(hs.drawing.windowLevels.modalPanel)
     dashboardView:frame({
           x = cres.x + cres.w * 0.15 / 2,
           y = cres.y + cres.h * 0.25 / 2,
           w = cres.w * 0.85,
           h = cres.h * 0.75
     })
  end

  function html_dashboard(content)
     local html = [[
        <!doctype html>
        <html lang="en">
          <head>
            <!-- Required meta tags -->
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">

            <!-- Bootstrap CSS -->
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

          </head>
          <body>
            <h1 style="text-align: center">Dashboard</h1>

        <div class="container">
                    ]] .. content .. [[

      </div>
          </body>
        </html>
                    ]]

     return html
  end

#+end_src

** Spoons
in ownCloud config folder

* Misc
** pyim
#+begin_src shell :tangle /tmp/dotfile-script.sh
  ln -s ~/ownCloud/Config/pyim ~/.emacs.d
#+end_src
** Snippets
#+begin_src shell :tangle /tmp/dotfile-script.sh
  ln -s ~/ownCloud/Config/snippets ~/.emacs.d
#+end_src
** bat
#+BEGIN_SRC conf :tangle ~/.config/bat/config :mkdirp "yes"
  --theme="Nord"
#+END_SRC
** gita
#+begin_src shell :tangle /tmp/dotfile-script.sh
  pip3 install -U gita
#+end_src

#+begin_src yaml :tangle /tmp/dotfile-yaml.yml
  repos:
    - name: socss
      url: git@github.com:teddy-ma/socss.gi

    - name: songofcode
      url: git@bitbucket.org:songofcode/songofcode.git
#+end_src

#+BEGIN_SRC conf :tangle ~/.config/gita/repo_path :mkdirp "yes"
  /Users/teddy/.emacs.d,.emacs.d
  /Users/teddy/Documents/org,org
  /Users/teddy/Documents/roam,roam
#+END_SRC
** wtfutil
命令行的 dashboard 工具

#+BEGIN_SRC conf :tangle ~/.config/wtf/config.yml :mkdirp "yes"
wtf:
  colors:
    background: black
    border:
      focusable: darkslateblue
      focused: orange
      normal: gray
    checked: yellow
    highlight:
      fore: black
      back: gray
    rows:
      even: yellow
      odd: white
  grid:
    columns: [50, 50, 50]
    rows: [10, 10, 10]
  navigation:
    shortcuts: false

  refreshInterval: 1
  mods:
    clocks_a:
      colors:
        rows:
          even: "lightblue"
          odd: "white"
      enabled: true
      locations:
        Vancouver: "America/Vancouver"
        Toronto: "America/Toronto"
      position:
        top: 0
        left: 1
        height: 1
        width: 1
      refreshInterval: 15
      sort: "alphabetical"
      title: "Clocks A"
      type: "clocks"
    clocks_b:
      colors:
        rows:
          even: "lightblue"
          odd: "white"
      enabled: true
      locations:
        Avignon: "Europe/Paris"
        Barcelona: "Europe/Madrid"
        Dubai: "Asia/Dubai"
      position:
        top: 0
        left: 2
        height: 1
        width: 1
      refreshInterval: 15
      sort: "alphabetical"
      title: "Clocks B"
      type: "clocks"
    feedreader:
      enabled: true
      feeds:
      - https://news.ycombinator.com/rss
      feedLimit: 10
      position:
        top: 1
        left: 1
        width: 2
        height: 1
      updateInterval: 14400
    power:
      enabled: true
      position:
        top: 2
        left: 1
        height: 1
        width: 1
      refreshInterval: 15
      title: "⚡️"
    textfile:
      enabled: true
      filePath: "~/.config/wtf/config.yml"
      format: true
      position:
        top: 0
        left: 0
        height: 4
        width: 1
      refreshInterval: 30
      wrapText: false
    uptime:
      args: [""]
      cmd: "uptime"
      enabled: true
      position:
        top: 2
        left: 3
        height: 1
        width: 1
      refreshInterval: 30
      type: cmdrunner

    work_git:
      commitCount: 5
      commitFormat: "[forestgreen]%h [grey]%cd [white]%s [grey]%an[white]"
      dateFormat: "%H:%M %d %b %y"
      enabled: true
      position:
        top: 0
        left: 3
        height: 2
        width: 1
      refreshInterval: 8
      repositories:
      - "/Users/teddy/code/gfresh/fishclub"
      type: git

    personal_git:
      commitCount: 5
      commitFormat: "[forestgreen]%h [grey]%cd [white]%s [grey]%an[white]"
      dateFormat: "%H:%M %d %b %y"
      enabled: true
      position:
        top: 0
        left: 4
        height: 2
        width: 1
      refreshInterval: 8
      repositories:
      - "/Users/teddy/code/todo"
      type: git

    resourceusage:
      cpuCombined: false
      enabled: true
      position:
        top: 2
        left: 2
        height: 1
        width: 1
        refreshInterval: 1
      showCPU: true
      showMem: true
      showSwp: true
#+END_SRC
** Xmodmap
swap control and capslock

#+begin_src conf :tangle (if (eq system-type 'gnu/linux) "~/.Xmodmap" : "no")
clear lock
clear control
keycode 66 = Control_L
add control = Control_L
add Lock = Control_R
#+end_src
* Server
** ownCloud
使用 docker 起一个网盘

只要 sudo docker-compose up

#+begin_src conf
version: '2.1'

volumes:
  files:
    driver: local
  mysql:
    driver: local
  backup:
    driver: local
  redis:
    driver: local

services:
  owncloud:
    image: owncloud/server:${OWNCLOUD_VERSION}
    restart: always
    ports:
      - ${HTTP_PORT}:8080
    depends_on:
      - db
      - redis
    environment:
      - OWNCLOUD_DOMAIN=${OWNCLOUD_DOMAIN}
      - OWNCLOUD_DB_TYPE=mysql
      - OWNCLOUD_DB_NAME=owncloud
      - OWNCLOUD_DB_USERNAME=owncloud
      - OWNCLOUD_DB_PASSWORD=owncloud
      - OWNCLOUD_DB_HOST=db
      - OWNCLOUD_ADMIN_USERNAME=${ADMIN_USERNAME}
      - OWNCLOUD_ADMIN_PASSWORD=${ADMIN_PASSWORD}
      - OWNCLOUD_MYSQL_UTF8MB4=true
      - OWNCLOUD_REDIS_ENABLED=true
      - OWNCLOUD_REDIS_HOST=redis
    healthcheck:
      test: ["CMD", "/usr/bin/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 5
    volumes:
      - /home/teddy/Public:/mnt/data

  db:
    image: webhippie/mariadb:latest
    restart: always
    environment:
      - MARIADB_ROOT_PASSWORD=owncloud
      - MARIADB_USERNAME=owncloud
      - MARIADB_PASSWORD=owncloud
      - MARIADB_DATABASE=owncloud
      - MARIADB_MAX_ALLOWED_PACKET=128M
      - MARIADB_INNODB_LOG_FILE_SIZE=64M
    healthcheck:
      test: ["CMD", "/usr/bin/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 5
    volumes:
      - mysql:/var/lib/mysql
      - backup:/var/lib/backup

  redis:
    image: webhippie/redis:latest
    restart: always
    environment:
      - REDIS_DATABASES=1
    healthcheck:
      test: ["CMD", "/usr/bin/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 5
    volumes:
      - redis:/var/lib/redis

#+end_src
** gogs
self host 的 git server

window 下要把 C:\Program Files\Git\usr\bin 加入到 path, 主要需要里面的 ssh-keygen

然后下载 gogs, 在命令行中执行 gogs.exe web, 设置界面要选择独立 ssh
** openwrt
直接使用镜像， 镜像转换需要以管理员身份执行
** simple file server
#+begin_src go
/*
Serve is a very simple static file server in go
Usage:
	-p="8100": port to serve on
	-d=".":    the directory of static files to host
Navigating to http://localhost:8100 will display the index.html or directory
listing file.
*/
package main

import (
	"flag"
	"log"
	"net/http"
)

func main() {
	port := flag.String("p", "8100", "port to serve on")
	directory := flag.String("d", ".", "the directory of static file to host")
	flag.Parse()

	http.Handle("/", http.FileServer(http.Dir(*directory)))

	log.Printf("Serving %s on HTTP port: %s\n", *directory, *port)
	log.Fatal(http.ListenAndServe(":"+*port, nil))
}

#+end_src
